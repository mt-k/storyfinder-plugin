<!DOCTYPE html>
<html>
	<head>
		<title>Storyfinder</title>
	</head>
	<style>
		iframe {
			position: fixed;
			left: 0px;
			top: 0px;
			bottom: 0px;
			right: 0px;
			width: 100%;
			height: 100%;
			border: 0;
		}
	</style>
	<script>
		var baseUrl = '';
		
		function initialize(){
			window.addEventListener("message", function(event){
				var origin = event.origin || event.originalEvent.origin;
				if(baseUrl.substr(0, origin.length) !== origin){
					alert('Wrong origin: ' + baseUrl.substr(0, origin.length) + ' !== ' + origin);
					return;
				}
				
				//if(typeof event.data !== 'object' || typeof event.data[0] === 'undefined' || typeof event.data[1] === 'undefined')return;
						
				if(event.data[0] === 'msg'){
					addon.port.emit('msg', event.data[1]);
				}
			}, false);
			
			addon.port.emit('ready');
		}
		
		addon.port.on('load', function(data){
			baseUrl = data.url;
			document.querySelector('body').innerHTML += '<iframe src="' + data.url + '" />';
		});
		
		addon.port.on('msg', function(data){
			document.querySelector('iframe').contentWindow.postMessage(data, '*');
		});
	</script>
	<body style="margin:0px; padding: 0px; background-color: #555555" onload="initialize()">
		
	</body>
</html>